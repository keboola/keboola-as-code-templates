CREATE TABLE `DEALS` (
  `ID` STRING(2000),
  `DEALNAME` STRING(255),
  `HS_FORECAST_AMOUNT` NUMERIC(38, 0),
  `CREATEDATE` STRING(255),
  `HS_IS_CLOSED` BOOL,
  `HS_DEAL_STAGE_PROBABILITY` NUMERIC(38, 0),
  `DAYS_TO_CLOSE` NUMERIC(38, 0),
  `HS_CREATED_BY_USER_ID` STRING(255),
  `HS_PROJECTED_AMOUNT` NUMERIC(38, 0),
  `HS_IS_CLOSED_WON` BOOL,
  `HS_CLOSED_AMOUNT_IN_HOME_CURRENCY` NUMERIC(38, 0),
  `DESCRIPTION` STRING(255),
  `AMOUNT_IN_HOME_CURRENCY` NUMERIC(38, 0),
  `HS_CLOSED_AMOUNT` NUMERIC(38, 0),
  `CLOSEDATE` STRING(255),
  `DEALTYPE` STRING(255),
  `AMOUNT` NUMERIC(38, 0),
  `HS_LASTMODIFIEDDATE` STRING(255),
  `PIPELINE` STRING(255),
  `DEALSTAGE` STRING(255),
  `PIPELINE_DISPLAY_ORDER` NUMERIC(38, 0),
  `HS_DATE_ENTERED_CLOSEDWON` STRING(255),
  `CREATED_AT_DATE` DATE,
  `CREATED_AT_TIME` TIME
)
INSERT INTO `DEALS`
SELECT
  D.`ID`,
  D.`DEALNAME`,
  D.`HS_FORECAST_AMOUNT`,
  D.`CREATEDATE`,
  D.`HS_IS_CLOSED`,
  D.`HS_DEAL_STAGE_PROBABILITY`,
  D.`DAYS_TO_CLOSE`,
  D.`HS_CREATED_BY_USER_ID`,
  D.`HS_PROJECTED_AMOUNT`,
  D.`HS_IS_CLOSED_WON`,
  D.`HS_CLOSED_AMOUNT_IN_HOME_CURRENCY`,
  D.`DESCRIPTION`,
  D.`AMOUNT_IN_HOME_CURRENCY`,
  D.`HS_CLOSED_AMOUNT`,
  D.`CLOSEDATE`,
  D.`DEALTYPE`,
  D.`AMOUNT`,
  D.`HS_LASTMODIFIEDDATE`,
  D.`PIPELINE`,
  PS.`LABEL` AS `DEALSTAGE`,
  PS.`DISPLAY_ORDER` AS `PIPELINE_DISPLAY_ORDER`,
  CASE WHEN D.`HS_IS_CLOSED_WON` = 'true' THEN D.`CLOSEDATE` ELSE NULL END AS `HS_DATE_ENTERED_CLOSEDWON`,
  CAST(NULLIF(D.`CREATEDATE`, '') AS DATE) AS `CREATED_AT_DATE`,
  TIME(NULLIF(D.`CREATEDATE`, '')) AS `CREATED_AT_TIME`
FROM `HS_DEALS` AS D
LEFT JOIN `HS_DEALS_PIPELINE_STAGES` AS PS
  ON D.`PIPELINE` = PS.`PIPELINE_ID` AND D.`DEALSTAGE` = PS.`ID`;